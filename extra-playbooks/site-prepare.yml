---
- name: include global default variables
  import_playbook: ../include_defaults.yml

- hosts: localhost
  any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
  roles:
    - { role: docker }
    - { role: container-registry/client }
  tags: always

- name: pull TACO provided images
  any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
  docker_image:
    name: "openstackclient"
    repository: openstackclient_image_repo
    tag: openstackclient_image_tag
    source: pull

- import_playbook: ../kubespray/cluster.yml
  when: not exclude_k8s_images

- hosts: localhost
  any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
  roles:
    - { role: taco-apps/openstack/pre-install, when: '"openstack" in taco_apps', vars: { prepare_manifest_only: true } }
    - { role: prepare-artifact }
  tags: always
